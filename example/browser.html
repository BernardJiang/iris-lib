<html>
<head>
  <title>identifi-lib</title>
  <script type="text/javascript" src="../dist/identifiLib.js"></script>
</head>
<body>
  <script type="text/javascript">
    let index;

    async function search() {
      const query = document.getElementById('query').value;
      let r = await index.search(query);
      let text = `Search results for "${query}":\n`;
      document.getElementById('searchResults').textContent = text;
      r.forEach(i => {
        document.getElementById('searchResults').appendChild(i.identicon(100));
      });
    }

    async function getProfile() {
      const profileQuery = document.getElementById('profileQuery').value;
      i = await index.get(profileQuery);
      let text = `Identity profile for ${profileQuery}:\n`;
      if (i) {
        text += JSON.stringify(i, null, 2);
        text += '\n';
        text += 'The most verified name for martti@moni.com:';
        text += JSON.stringify(i.verified('name'), null, 2);
        document.getElementById('identicon').appendChild(i.identicon(100));
      } else {
        text += 'Profile not found'
      }
      document.getElementById('profileResults').textContent = text;
    }

    window.identifiLib.Index.load().then(async (index_) => {
      index = index_;
      document.getElementById('searchResults').textContent = 'Searching...';
      document.getElementById('profileResults').textContent = 'Searching...';
      await search(index);
      await getProfile(index);
      document.getElementById('query').addEventListener('change', search);
      document.getElementById('profileQuery').addEventListener('change', getProfile);
    });
  </script>

  <p id="identicon"></p>

  <input type="text" value="ma" id="query" onkeyup="search()"></input>
  <pre id="searchResults"></pre>

  <input type="text" value="martti@moni.com" id="profileQuery" onkeyup="getProfile()"></input>
  <pre id="profileResults"></pre>

</body>
</html>
